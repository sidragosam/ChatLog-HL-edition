$(document).ready(function(){
	function e(){$(".generated").remove(),$(".clear").remove();
	for(var e=$("textarea").val().split("\n"),t=0;t<e.length;t++)$(".output").append('<div class="generated">'+e[t].slice(11+21)
	.replace("mondja:", "<font color='#FFFFFF'>mondja: ")
	.replace("súgja:", "<font color='#FFFFFF'>súgja: ")
	.replace("kiáltja:", "<font color='#FFFFFF'>kiáltja: ")
	.replace("[S]", "<font color='#FFFFFF'>[S]</color><font color='00b3ff'>")
	.replace("[C]", "<font color='#FFFFFF'>[C]</color><font color='00b3ff'>")
	.replace("[Angol]", "<font color='#FFFFFF'>[Angol]</color><font color='00b3ff'>")
	+'</color></div><div class="clear"></div>');
	$(".generated").each(function(){
			txtString=$(this).text(),
			
			//ALAPVETŐ FUNKCIÓK
			txtString.toLowerCase().indexOf("***")>=0&&$(this).addClass("me"),
			txtString.toLowerCase().indexOf(" ((")>=0&&$(this).addClass("do"),
			txtString.toLowerCase().indexOf(">>")>=0&&$(this).addClass("ame"),
			txtString.toLowerCase().indexOf(" mondja:")>=0&&$(this).addClass("white"),
			txtString.toLowerCase().indexOf(" súgja:")>=0&&$(this).addClass("white"),
			txtString.toLowerCase().indexOf(" kiáltja:")>=0&&$(this).addClass("white"),
			
			//EGYEBEK
			/*txtString.toLowerCase().indexOf(" suttogja:")>=0&&$(this).addClass("grey"),
			txtString.toLowerCase().indexOf(" mondja távolról:")>=0&&$(this).addClass("tavol"),
			txtString.toLowerCase().indexOf(" mondja a megafonba:")>=0&&$(this).addClass("megafon"),*/
			txtString.indexOf("[Rádió")>=0&&$(this).addClass("radio"),
			txtString.indexOf("[M. Rádió")>=0&&$(this).addClass("radio"),
			txtString.indexOf("[R. Rádió")>=0&&$(this).addClass("radio"),
			
			//REMOVE
			txtString||$(this).remove(),

			$(".generated:first").css("margin-top","30px"),$(".generated:first").css("padding-top","10px"),
			$(".generated:last").css("padding-bottom","10px"),$(".generated:last").css("margin-bottom","30px"),
			$(".generated").css("background-color","#"+$("#color-picker").spectrum("get").toHex())})}charName=$("#name").val().toLowerCase();
			var t=$.jStorage.get("lastCharName");t||$.jStorage.set("lastCharName",""),
			$("#name").val($.jStorage.get("lastCharName")),$("#name").bind("input propertychange",
			function(){charName=$("#name").val().toLowerCase(),$.jStorage.set("lastCharName",charName),e()});
			var r=$.jStorage.get("lastFontSize"),o=$.jStorage.get("lastLineHeight");
			r||o?($(".output").css({"font-size":$.jStorage.get("lastFontSize")+"px","line-height":$.jStorage.get("lastLineHeight")+"px"}),
			$("#font-label").text("Betűméret ("+$.jStorage.get("lastFontSize")+"px):")):($.jStorage.set("lastFontSize","12"),
			$.jStorage.set("lastLineHeight","0")),$("#decrease-fontsize").click(function(){
				currentSize=parseInt($(".output").css("font-size")),currentSize--,currentLineHeight=parseInt($(".output").css("line-height")),
				currentLineHeight--,currentLineHeight>=0?($(".output").css({"font-size":currentSize+"px","line-height":currentLineHeight+"px"}),
				$("#font-label").text("Betűméret ("+currentSize+"px):"),$.jStorage.set("lastFontSize",currentSize),
				$.jStorage.set("lastFontSize",currentLineHeight)):$(this).addClass("disabled")}),$("#increase-fontsize").click(function(){
					currentSize=parseInt($(".output").css("font-size")),currentSize++,currentLineHeight=parseInt($(".output").css("line-height")),
					currentLineHeight++,$(".output").css({"font-size":currentSize+"px","line-height":currentLineHeight+"px"}),
					$("#font-label").text("Betűméret ("+currentSize+"px):"),$.jStorage.set("lastFontSize",currentSize),
					$.jStorage.set("lastLineHeight",currentLineHeight),$("#decrease-fontsize").removeClass("disabled")}),
					$("#reset-fontsize").click(function(){$(".output").css({"font-size":"12px","line-height":"0px"}),
					$("#font-label").text("Betűméret (12px):"),$.jStorage.set("lastFontSize","12"),$.jStorage.set("lastLineHeight","0")}),
					$("textarea").bind("input propertychange",function(){
						e()}),$("#color-picker").spectrum({color:"#000",showInput:!0,preferredFormat:"hex",change:function(){
							$.jStorage.set("lastColor",$("#color-picker").spectrum("get").toHex()),
							$(".generated").css("background-color","#"+$("#color-picker").spectrum("get").toHex())}}),
							$("#color-picker").spectrum("set",$.jStorage.get("lastColor"))});